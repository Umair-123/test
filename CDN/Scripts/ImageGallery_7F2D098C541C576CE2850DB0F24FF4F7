(function(n){for(var i=["Width","Height"],t;t=i.pop();)(function(t,i){n.fn[t]=t in new Image?function(){return this[0][t]}:function(){var r=this[0],n,t;return r.tagName.toLowerCase()==="img"&&(n=new Image,n.src=r.src,t=n[i]),t}})("natural"+t,t.toLowerCase())})(jQuery),Vista.ImageResize={},Vista.ImageResize.BoundHorizontally=function(n,t){var r=n.width(),i=n.height();window.setTimeout(function(){var n=t.height()!==0?t.height():i,u=t.width()!==0?t.width():r,s=i,h,c,f,e,o;n<i&&(n=i,u=r),h=s/n*u,t.height(s),t.width(h),n=t.height(),u=t.width(),u>r&&(c=r,f=r/u*n,t.width(c),t.height(f),t.addClass("horizontal-bound")),i>n&&(e=i-n,o=Math.ceil(e/2),t.css("top",o),t.addClass("horizontal-bound"))},50)},Vista.GetImagesAsync=function(n,t){function u(n,t){return $.Deferred(function(i){t.onload=function(){i.resolve(t)},t.onerror=function(){i.reject(),(!t.fileSize||t.fileSize<0)&&r.remove()},t.src=n;var r=$(t);r.addClass("gallery-image other-image")}).promise()}var f=t.height()||300,i=$.Deferred(),r=[];return n.filter(function(n){var f=new Image,e;r.push(u(n.ImagePath,f)),f=$(f),f.removeAttr("height"),f.removeAttr("width"),n.Link?(e=$('<a target="_blank" />'),e.attr("href",n.Link),f.appendTo(e),t.append(e)):t.append(f)}),$.each(r,function(){this.done(function(n){var r=$(n);Vista.ImageResize.BoundHorizontally(t,r),i.resolve()})}),i.promise()},Vista.ImageGallery=function(n,t){function f(n){var f,t;return n=n%i.length,f=$(i[u]),f.removeClass(a),f.addClass(l),t=$(i[n]),t.addClass(a),t.removeClass(l),$(r[u]).removeClass(e),$(r[n]).addClass(e),$(o[u]).removeClass(e),$(o[n]).addClass(e),u=n,!0}function h(){c=setTimeout(function(){y(),h()},t)}function y(){f(u+1)}function v(){clearTimeout(c);var t=$(this),n=r.index(t);f(n),h()}var c;t=t||7e3;var i=[],u=0,a="current-image",l="other-image",e="selected",r=[],s,o=[];(function(){var t,u;if(i=n.find("img.gallery-image"),i.length!=0){if(i.length===1){f(0);return}n.append('<div class="image-select-container"></div>'),t=n.find(".image-select-container"),t.append('<div class="image-select-inner"></div>'),u=t.find(".image-select-inner"),n.append('<div class="image-descriptions"></div>'),s=n.find(".image-descriptions"),i.each(function(t,i){u.append('<span class="image-select">&nbsp;</span>');var r=$(this).data("description");r&&s.append("<span class=image-description>"+r+"</span>"),Vista.ImageResize&&Vista.ImageResize.BoundHorizontally(n.find(".images"),$(i))}),r=n.find(".image-select"),r.bind("click",v),o=s.find(".image-description"),f(0),h()}})()},Vista.ImagePopout=function(n){function i(){var i=$(this);t(i)}function t(n){var u=n.clone(),f=$(n[0]).naturalWidth(),r=$(n[0]).naturalHeight(),o=$(window).width()-150,e=$(window).height()-150,i=r,t=f;r>e?(i=e,t=e/r*f):f>o&&(t=o,i=o/f*r),u.attr("width",t).attr("height",i).css("position","inherit"),u.width(t),u.height(i),$.modal('<div id="frame-hook"></div>',{overlayClose:!0,opacity:50,modal:!0,containerCss:{backgroundColor:"#2B2725",width:t,height:i+15},overlayCss:{backgroundColor:"#000"},closeHTML:'<button type="button" id="close-gallery" class="user-action"><span class="icon">'+Vista.Lang.Shared.Close+"</span></button>"}),$("#frame-hook").append(u)}(function(){n.find("img.gallery-image").bind("click",i)})()},Vista.Images=function(){function n(n,t,i,r){function u(t){for(var o=[],f,u=0;u<t.length;u++)o.push(i(t[u]));return f=Vista.GetImagesAsync(o,e),$.when(f).done(function(){var i,t;n.removeClass("loading"),i=new Vista.ImageGallery(n),r&&(t=new Vista.ImagePopout(n))})}n.append('<div class="images" />');var e=n.find(".images"),f=$.get(t);$.when(f).done(u)}return{ImageGalleryFromFolder:function(t,i,r,u,f){var e=t.data("id"),h=Vista.Utilities.format(Vista.Urls.CDN.GetImageData,i,e,u,f),s=Vista.Urls.CDN.GalleryImage,o=function(n){return{ImagePath:Vista.Utilities.format(s,i,e,n.ImagePath,u,f)}},c=n(t,h,o,r)},AdvertImages:function(t,i,r){var f=Vista.Utilities.format(Vista.Urls.Ads.GetAdData,i,r),u=function(n){return{ImagePath:n.ImagePath,Link:n.Link}};n(t,f,u)}}}()