Vista.SelectGrid.SelectGridControl=function(n,t,i,r){"use strict";function e(n){u();var t=$.extend(new Vista.Models.Ticket,{ticketTypeCode:n.getCode(),description:n.getDescription(),priceEachInCents:n.getValue(),loyaltyPointsCost:n.getData().loyaltyPointsCost,loyaltyRecognitionId:n.getData().loyaltyRecognitionId,quantity:n.getCount(),includedFeeForDisplay:n.getData().ticketFeeForDisplay,ticketFeeEachInCents:n.getData().ticketFeeInCents});n.setTotal(t.totalPriceInCents()),typeof i=="function"&&i(t)}function f(){var t=n.getTotal();return typeof r=="function"&&(t+=+r()||0),t}function u(){var i=f();n.setCount(i),n.setRemaining(Math.max(t-i,0))}(function(){t=+t||10;n.onValueChange(e);n.setMax(t),u()})(),this.maxSelected=function(){return f()===t},this.refresh=function(){u()}},Vista.SelectGrid.SelectGridView=function(n){"use strict";function f(n){n.stopPropagation(),typeof t=="function"&&t($(n.target).data("selectgriditem"))}var r=new Vista.SelectGrid.SelectGridSelector,i=new Vista.SelectGrid.SelectGridCounter,u=[],t;n.on(Vista.SelectGrid.SelectGridItem.Events.change,f);n.find(".select-grid-item").each(function(){var t=$(this),n=new Vista.SelectGrid.SelectGridItem(t,r);t.data("selectgriditem",n),u.push(n)}),n.after(i),this.onValueChange=function(n){t=n},this.setCount=function(n){i.setValue(n)},this.getTotal=function(){return u.reduce(function(n,t){return n+t.getCount()*t.getWeigh()},0)},this.setMax=function(n){i.setMax(n)},this.setRemaining=function(n){r.setMax(n)}},function(){"use strict";function e(n){n.stopPropagation();var i=$(n.target);i.is("select")||(i.is(".icon")?(this.clear(),this.isActive()?this.setInactive():r.call(this)):this.isActive()?this.setInactive():(t(),this.setActive()))}function f(){this.finalValue=this.input.val(),this.setInactive()}function t(){n&&n.setInactive(),n=undefined}function i(){this.container.trigger(u.change)}function r(){this.input.val(this.finalValue),this.display.length||(this.display=$("<div></div>").addClass("select-grid-count").hide().appendTo(this.container)),this.input.val()>0?(this.container.addClass("select-grid-active"),this.display.text(this.input.val()),this.display.show()):(this.container.removeClass("select-grid-active"),this.display.hide()),i.call(this)}var u={change:"selectgriditemchange"},n;$("body").on("click",t);Vista.SelectGrid.SelectGridItem=function(n,t){this.container=n,this.display=n.find(".select-grid-count"),this.input=n.find("select").hide(),this.selector=t,this.finalValue=0;this.input.on("change",$.proxy(f,this));this.container.on("click",$.proxy(e,this));this.description=n.find(".select-grid-description"),this.total=n.find(".select-grid-total")},Vista.SelectGrid.SelectGridItem.Events=u,Vista.SelectGrid.SelectGridItem.prototype.getCode=function(){return this.input.data("code")},Vista.SelectGrid.SelectGridItem.prototype.getData=function(){return this.input.data()},Vista.SelectGrid.SelectGridItem.prototype.getDescription=function(){return this.description.text()},Vista.SelectGrid.SelectGridItem.prototype.getCount=function(){return+this.input.val()},Vista.SelectGrid.SelectGridItem.prototype.getWeigh=function(){return+(this.input.data("weigh")||1)},Vista.SelectGrid.SelectGridItem.prototype.getValue=function(){return+this.input.data("value")},Vista.SelectGrid.SelectGridItem.prototype.setTotal=function(n){this.total.text(Vista.FormatUtilities.formatCurrency(n,!0))},Vista.SelectGrid.SelectGridItem.prototype.setActive=function(){n=this,this.container.addClass("select-grid-selected").removeClass("select-grid-active"),this.finalValue=this.input.val(),this.input.val(this.input.find("option:first").val()),i.call(this),this.display.hide(),this.selector.setSource(this.input),this.selector.setWeigh(this.getWeigh()),this.container.append(this.selector.show())},Vista.SelectGrid.SelectGridItem.prototype.setInactive=function(){this===n&&(n=undefined),this.container.removeClass("select-grid-selected"),this.selector.hide(),r.call(this)},Vista.SelectGrid.SelectGridItem.prototype.isActive=function(){return this.container.hasClass("select-grid-selected")},Vista.SelectGrid.SelectGridItem.prototype.clear=function(){this.finalValue=this.input.find("option:first").val()}}(),Vista.SelectGrid.SelectGridSelector=function(){"use strict";function e(){if(r/i<=10)n.hide(),o(),t.find("span").each(function(){var n=$(this);n[n.data("value")*i>r?"addClass":"removeClass"]("disabled")});else{f(),n.show();var u=n.data("selectgridoptions");u||(u=[],n.data("selectgridoptions",u)),n.append(u),u.length=0,n.find("option").each(function(){var n=$(this);n.val()*i>r&&(n.detach(),u.push(n))})}}var t=$('<div class="select-grid-selector"></div>'),u=$(),n=$(),r=10,i=1,o=$.proxy(t.show,t),f=$.proxy(t.hide,t);(function(){for(var n=1;n<=10;n++)t.append($("<span></span>").data("value",n).text(n))})(),$.extend(this,t);t.on("click","span",function(t){t.stopPropagation(),u=$(this),u.is(".disabled")?t.preventDefault():n.val(+u.data("value")).change()});this.setMax=function(i){r=i,(t.is(":visible")||n.is(":visible"))&&e()},this.setSource=function(t){n&&n.hide(),n=t},this.setWeigh=function(n){i=n},this.show=function(){return e(),this},this.hide=function(){return n.hide(),f(),this}},Vista.SelectGrid.SelectGridCounter=function(){"use strict";var n,i,t;(function(){n=$(".select-grid-counter"),(i=$("<span></span>").text(0)).insertBefore(n.find("p")),$("<span></span>").text("/").insertBefore(n.find("p")),(t=$("<span></span>").text(0)).insertBefore(n.find("p"))})(),$.extend(this,n),this.setValue=function(n){i.text(n)},this.setMax=function(n){t.text(n)}}